#<AdxTL>@(#)0.0.0.0 $Revision$
#Local Integer LRET
#
#Local Char PLANTA(5) : PLANTA =  "11"
#Local Decimal CONTADOR_STOCK : CONTADOR_STOCK = 2291.0
#Local Char CODIGO_ARTICULO(15) : CODIGO_ARTICULO = "BNEX001BG"
#Local Integer SECUENCIA : SECUENCIA = 99999966
#Local Char DOCUMENTO(15) : DOCUMENTO = "PDV112301160"
#Local Integer LINEA : LINEA = 1000
#Local Decimal CANTIDAD : CANTIDAD = 1.0
#Local Char LMESS(255)



#Local Decimal CONT : CONT = 0.0
#
#Call DESASIGNA_STOCK(PLANTA, CODIGO_ARTICULO, CONT, SECUENCIA, LRET) From YAPPLIB
#
#Infbox("Desasignado")

#Call ASIGNACION_DETALLADA(PLANTA, CODIGO_ARTICULO, SECUENCIA, CONTADOR_STOCK, CANTIDAD, DOCUMENTO , LINEA, LRET, LMESS) From YAPPLIB

#Infbox("Asignado")
#
#Call MAJALLORD(DOCUMENTO, LINEA, LINEA, 2, 1, CANTIDAD, 0, LRET) From TRTVENALL
#
#Infbox("MAJALLORD")
#
#Local Char PEDIDO(25) : PEDIDO = "PDV112301442"
#Local Char CONTENEDOR(25) : CONTENEDOR = "PP23000628"
#Local Integer LRET
#Local Char LMESS(255)
#
#Call ASIGNACION_DETALLADA(PEDIDO, CONTENEDOR, LRET, LMESS) From YAPPLIB
#

#WALL=WALLSTU*(1/[F:SOP]SAUSTUCOE)
#    Call QTEARR(WALL, [F:SOP]SAU) From TRTDIV
#    WSHT=WSHTSTU*(1/[F:SOP]SAUSTUCOE)
#    Call QTEARR(WSHT, [F:SOP]SAU) From TRTDIV
#    Case LTRTALL
#        When 1 :    #    Allocation
#            WALLSTU= [F:SOQ]ALLQTYSTU + WALLSTU
#        When 2 :    #    Désallocation
#            WALL*=-1
#            WSHT*=-1
#            WALLSTU=[F:SOQ]ALLQTYSTU-WALLSTU
#            WSHTSTU=[F:SOQ]SHTQTYSTU-WSHTSTU
#    Endcase
#    Call MAJALLORD(DOCUMENTO, LINEA, LINEA, 2, 1, CANTIDAD, 0, LRET) From TRTVENALL
#    If WRET <> 0 : GOK = 0 : Goto AB_DIVALL : Endif




#Gosub APRES_STOALL From SUBSOH1
#Call ASIGNACION_DETALLADA(PLANTA, CODIGO_ARTICULO, CONTADOR_STOCK, CANTIDAD, DOCUMENTO , LINEA, LRET) From YAPPLIB
#Infbox("RESULTADO: " + num$(LRET))


#Call SUPALL("11","BN11817070BK",17209.0,99999999,LRET) From STKALL
#Infbox num$(LRET)

#Call CREALL(2,"11","BN11817070BK",17209.0,date$,1,1,3,"DPR112300000302",1,0,"",date$,"","","","","","",0.00,0.00,"","","","",1,"",LRET) From STKALL

#Call CREALL( DETAILED ALLOCATION, SITE, PRODUCT, STOCOU, RESERVATION End Date, QTY, QTY, VCRTYP,WORK Order NUMBER, LINE NUMBER, COMPONENT BOM SEQUENCE,
#preparation number,allocation date, lot, sublot, status, location,serial number, warehouse, qty already allocated, qty already allocated, default location,
#default location type,BP, address code,include internal subcontract location,version,return code)



################################################################################################################
If 1=2
  Local Integer  PSOPLIN(9999)
  Local Char  PITMREF(25)(9999)
  Local Char   PITMDES(250)(9999)
  Local Char   PLPNNUM(50)(9999)
  Local Char   PPRTFLG(10)(9999)
  Local Decimal PQTY(9999)
  Local Decimal  PQTYLPN(9999)
  Local Char   PLPNNUM_USADO
  Local Char   PRES
  Local Char   PMESS

  Call GETLSLIPED ("PDV112400049", "10/01/2024", "", "", PSOPLIN, PITMREF, PITMDES, PLPNNUM, PPRTFLG ,PQTY, PQTYLPN, PLPNNUM_USADO,PRES, PMESS) From YAPPLIB
  Infbox PITMREF
  Infbox num$(PQTY)
Endif




################################################################################################################
If 1=2
  Local Char LRES
  Local Char LMESS
  Call PUTDLVFLG ("DPR112300000621", "NUN04", 1, LRES, LMESS) From YAPPLIB
Endif





################################################################################################################
If 1=2
  Local Char PPRHNUM : YPRHNUM = "DPR112300000615"
  Local  Integer YPRELIN
  Local Char YORINUM
  Local Integer YORILIN
  Local Char PITMREF
  Local Char PITMDES1
  Local Decimal PQTYSTU
  Local Decimal PYQTYSTU
  Local Decimal PALLQTY
  Local Decimal PPENDIENTE
  Local Char PPACNUM
  Local Char PSERNUM
  Local Char PLOT
  Local Char PCONTENEDOR
  Local Char PRES
  Local Char PMESS
  Call GETYSTOPRED(YPRHNUM , YPRELIN, YORINUM, YORILIN,  PITMREF, PITMDES1,  PQTYSTU, PYQTYSTU,  PALLQTY, PPENDIENTE,  PSERNUM, PLOT, PCONTENEDOR, PPACNUM, PRES, PMESS) From YAPPLIB
  Infbox PITMREF
Endif


################################################################################################################
If 1=2
  Local Char PSOHNUM : PSOHNUM = "PDV112301883"
  Local Char PSHIDAT : PSHIDAT = gdat$(15,12,2023)
  Local Char PTSICOD0
  Local Char PTSICOD1
  Local Integer  PSOPLIN
  Local Char  PITMREF
  Local Char   PITMDES
  Local Char   PLPNNUM
  Local Char   PPRTFLG
  Local Decimal PQTY
  Local Decimal  PQTYLPN
  Local Char   PLPNNUM_USADO
  Local Char   PRES
  Local Char   PMESS

Call GETLSLIPED (PSOHNUM, PSHIDAT, PTSICOD0, PTSICOD1, PSOPLIN, PITMREF, PITMDES, PLPNNUM, PPRTFLG ,PQTY, PQTYLPN, PLPNNUM_USADO,PRES, PMESS  ) From YAPPLIB

Endif





#########################################################################
# BORRADO DE UN SEGUIMIENTO
If 1=2
#Infbox 'BORRADO DE UN SEGUIMIENTO'
If !clalev([F:ITF])  Local File ITMFACILIT     [ITF] : Endif
If !clalev([F:STO])  Local File STOCK          [STO] : Endif
If !clalev([F:SOQ])  Local File SORDERQ        [SOQ] : Endif
If !clalev([F:STJ])  Local File STOJOU         [STJ] : Endif
If !clalev([F:ORD])  Local File ORDERS         [ORD] : Endif

#Subprog DEL_SUIV(LRET)
Variable Integer LRET
Local Char WGREP(2)
Local Integer WOPECLENBR, WITMCLENBR, WMATCLENBR
Local Decimal WCPLQTY,WREJQTY,WQUAQTY
Global Date GWIPTDAT
Global Shortint GMFGTRACE         : # affichage d'une trace en gestion
Local Integer OK : OK = 1
Gosub OPEN_FILE From MTKLIB
# 06.06 demande 36615
#Call OUVRE_TRACE("Borrado de seguimientos Sanycces") From LECFIC
GMTKMTSNUM = 'SAN'    #*********************
Read [MTS] MTS0 = 2;GMTKMTSNUM
#Infbox "168"
If fstat : Raz[F:MTS] : LRET = 1 : Return : Endif
Readlock [F:MTK]MTK0 = 'SG112400122'  #*********************
If fstat = 5 : End : Endif
If fstat GOK=0  : Call RSTA("MTK",[F:MTK]PTHNUM-num$([F:PTD]PTDLIN)) From GLOCK : End
Endif
#Infbox "175"
Read [F:MFG]MFG0 = [F:MTK]MFGNUM
If fstat : Raz [F:MFG] : Endif
#contrôle que l'OF n'est pas clos et que la période est ouverte pour maj du stock
GTYPGEN = 1  # Fuerzo valor #*********************
Gosub VERF_ANU From SUBMTKA
If OK = 0 : LRET = 1 : End : Endif
#Il faut forcer GREP à "A" (en suppression simple d'une ligne GREP = "M" et c'est pas bon!!!)
WGREP = GREP
GREP  = "A"
Gosub ANNULE_SUIV From SUBMTKC
GREP = WGREP
If GOK = 1
   Delete [F:MTK]
   If fstat :GOK = 0 : GLOCK = "$"+"MFGHEADTRK" : Endif

#Call ECR_TRACE("Borrado ok seguimiento",0) From GESECRAN

Endif
# Call FERME_TRACE From LECFIC
# Call LEC_TRACE From LECFIC # leo traza
If GOK < 1 : LRET = 1 : End : Endif
End
Endif



#########################################################################
# generacion fichero dachser
If 1=2
Local Char POK
Call DACHSER_GENERA_FICHERO ("DPR112400000196", POK) From YENVDACH
Endif




#############################################
If 1=2
# Impresión automática del informe de entregas
Subprog PRINT_SDH(VPLA,VSDH,VCLI,VDAT, RES)
Value Char VPLA   # Planta
Value Char VSDH   # Número de la entrega
Value Char VCLI   # Cliente
Value Char VDAT   # Fecha de la entrega
Variable Integer RES

Local Char VINF : VINF = "ZBONLIV"
Local Char VDES   # Destino de impresión
Local Char TBVAL(20)(20)
Local Char TBPAR(20)(20)

TBPAR(1) = "sitedeb"
TBVAL(1) = VPLA


TBPAR(2) = "sitefin"
TBVAL(2) = VPLA


TBPAR(3) = "Livraisondeb"
TBVAL(3) = VSDH


TBPAR(4) = "Livraisonfin"
TBVAL(4) = VSDH


TBPAR(5) = "clientdeb"
TBVAL(5) = VCLI


TBPAR(6) = "clientfin"
TBVAL(6) = VCLI


TBPAR(7) = "datedeb"
TBVAL(7) = VDAT


TBPAR(8) = "datefin"
TBVAL(8) = VDAT


TBPAR(9) = "valdeb"
TBVAL(9) = "1"


TBPAR(10) = "valfin"
TBVAL(10) = "2"


TBPAR(11) = "facdeb"
TBVAL(11) = "1"


TBPAR(12) = "facfin"
TBVAL(12) = "2"


If !clalev([X1]) : Local File SDELIVERY  [X1] : Endif
If !clalev([X2]) : Local File AREPORT    [X2] : Endif
Read [X1]SDH0 = VSDH
If fstat = 0
  If [X1]PRNNDE = 2
    TBPAR(13) = "codimp"
    TBVAL(13) = "2"    # Reimpresión
  Else
    TBPAR(13) = "codimp"
    TBVAL(13) = "1"    # Impresión
  Endif
Endif
Read [X2]ARP0 = VINF
If fstat = 0
  VDES = [X2]PRTDEF
Endif
Close Local File [X1]
Close Local File [X2]


If VINF <> "" and VDES <> ""
  Call ETAT(VINF,VDES,"",0,"",TBPAR,TBVAL) From AIMP3
  RES = fstat
Endif
End
Endif


#############################################
If 1=2
# Creación automática de la entrega a partir del documento de preparación
Subprog MAKE_SDH(VPRE, VNUM)
  Value Char VPRE
  Variable Char VNUM

  If !clalev([M:YGSDH])  Local Mask YGENSDH     [YGSDH]   Endif

  Default Mask [YGSDH]

  [M:YGSDH]SOCIEDAD = "1"
  [M:YGSDH]PLANTA   = "11"
  [M:YGSDH]TIPOSDH  = "SDH"
  [M:YGSDH]PREPARAINI  = VPRE
  [M:YGSDH]PREPARAFIN  = VPRE

#Gosub OK From SPEYGSDH

  Local Integer TRACE : TRACE = 1 # 1 = No Traza --- 2 = Si Traza
  #Llamamos a la funcion de generar entregas
  Call GEN_SDH([L]TRACE, VNUM) From SPEYGSDH

  Close Local Mask [YGSDH]

End
Endif
